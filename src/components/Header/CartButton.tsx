"use client";
import React, { useEffect } from "react";
import { useRouter } from "next/navigation";
import { useModal } from "@/contexts/ModalContext";

const CartButton = () => {
  const router = useRouter();
  const { openLoginModal } = useModal();

  useEffect(() => {
    // Preload the Cart page
    router.prefetch("/Cart");
  }, [router]);

  const handleClick = () => {
    try {
      const token = localStorage.getItem("jwtToken");

      if (token) {
        router.push("/Cart");
      } else {
        localStorage.setItem("redirectAfterLogin", "/Cart"); // Store redirect path
        openLoginModal(); // Trigger the sign-in modal
      }
    } catch (error) {
      console.error("Error in CartButton:", error);
    }
  };

  return (
    <div
      onClick={handleClick}
      role="button"
      tabIndex={0}
      className="flex items-center cursor-pointer relative top-0.5 w-[95px] h-[24px]"
    >
      <svg
        viewBox="0 0 24 24"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
        className="h-[20.5px] w-[19.47px]"
      >
        <path
          d="M15.9999 9C15.9999 9.55229 15.5522 10 14.9999 10C14.4477 10 13.9999 9.55229 13.9999 9C13.9999 8.44772 14.4477 8 14.9999 8C15.5522 8 15.9999 8.44772 15.9999 9Z"
          fill="#242424"
        />
        <path
          d="M9.99994 9C9.99994 9.55229 9.55223 10 8.99994 10C8.44766 10 7.99994 9.55229 7.99994 9C7.99994 8.44772 8.44766 8 8.99994 8C9.55223 8 9.99994 8.44772 9.99994 9Z"
          fill="#242424"
        />
        <path
          fillRule="evenodd"
          clipRule="evenodd"
          d="M11.9999 2.75C10.7573 2.75 9.74994 3.75736 9.74994 5V5.25447C10.1674 5.24999 10.6181 5.25 11.1052 5.25H12.8947C13.3817 5.25 13.8324 5.24999 14.2499 5.25447V5C14.2499 3.75736 13.2426 2.75 11.9999 2.75ZM15.7499 5.30694V5C15.7499 2.92893 14.071 1.25 11.9999 1.25C9.92887 1.25 8.24994 2.92893 8.24994 5V5.30694C8.11494 5.31679 7.98467 5.32834 7.85892 5.34189C6.98056 5.43657 6.24602 5.63489 5.59372 6.08197C5.36938 6.23574 5.15865 6.40849 4.96387 6.59833C4.39754 7.15027 4.05902 7.83166 3.79393 8.67439C3.53655 9.49258 3.32854 10.5327 3.06717 11.8396L3.04809 11.935C2.67145 13.8181 2.37466 15.302 2.28942 16.484C2.20232 17.6916 2.32403 18.7075 2.89607 19.588C3.08693 19.8817 3.3097 20.1534 3.56031 20.3982C4.31145 21.1318 5.2838 21.4504 6.48506 21.6018C7.66074 21.75 9.17405 21.75 11.0945 21.75H12.9054C14.8258 21.75 16.3391 21.75 17.5148 21.6018C18.7161 21.4504 19.6884 21.1318 20.4396 20.3982C20.6902 20.1534 20.913 19.8817 21.1038 19.588C21.6759 18.7075 21.7976 17.6916 21.7105 16.484C21.6252 15.3021 21.3284 13.8182 20.9518 11.9351L20.9327 11.8396C20.6713 10.5327 20.4633 9.49259 20.206 8.67439C19.9409 7.83166 19.6023 7.15027 19.036 6.59833C18.8412 6.40849 18.6305 6.23574 18.4062 6.08197C17.7539 5.63489 17.0193 5.43657 16.141 5.34189C16.0152 5.32834 15.8849 5.31679 15.7499 5.30694ZM8.01966 6.83326C7.27295 6.91374 6.81164 7.06572 6.44176 7.31924C6.28826 7.42445 6.14407 7.54265 6.0108 7.67254C5.68966 7.98552 5.45016 8.40807 5.2248 9.12449C4.9945 9.85661 4.80134 10.8172 4.52955 12.1762C4.14001 14.1239 3.86317 15.5153 3.78553 16.5919C3.70894 17.6538 3.83826 18.2849 4.15388 18.7707C4.28447 18.9717 4.4369 19.1576 4.60837 19.3251C5.02281 19.7298 5.61634 19.9804 6.67266 20.1136C7.74356 20.2486 9.16218 20.25 11.1485 20.25H12.8514C14.8377 20.25 16.2563 20.2486 17.3272 20.1136C18.3835 19.9804 18.9771 19.7298 19.3915 19.3251C19.563 19.1576 19.7154 18.9717 19.846 18.7707C20.1616 18.2849 20.2909 17.6538 20.2144 16.5919C20.1367 15.5153 19.8599 14.1239 19.4703 12.1762C19.1985 10.8173 19.0054 9.85661 18.7751 9.12449C18.5497 8.40807 18.3102 7.98552 17.9891 7.67254C17.8558 7.54265 17.7116 7.42445 17.5581 7.31924C17.1882 7.06572 16.7269 6.91374 15.9802 6.83326C15.2172 6.75101 14.2373 6.75 12.8514 6.75H11.1485C9.76259 6.75 8.78273 6.75101 8.01966 6.83326Z"
          fill="#242424"
        />
      </svg>
      <span className="text-[#242424] text-base font-normal ml-1">Your Cart</span>
    </div>
  );
};

export default CartButton;